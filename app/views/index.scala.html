@(implicit req: RequestHeader)

@main("Welcome to Play") {

    <div id="log"></div>
    <input type="text" name ="message" placeholder="your message"/>

    <script>

            var user = prompt("What should be your username");
        var websocket = new WebSocket("@controllers.routes.Application.chatUserSocket.webSocketURL()");
        websocket.onmessage = function(msgFromSocket) {
            var m = JSON.parse(msgFromSocket.data);
            console.log(m);
            console.log(msgFromSocket);
            var isItMe = m.user === user ?  "myMessage" : "friendsMessage";
            var whoSentMessage = m.autoGenerated ? "botMessage" : isItMe;
            var messageClass = "'"+whoSentMessage+"'";
            $("#log").append("<div class="+messageClass+">"+m.user + ": " + m.message.replace(/\n/g,"<br>")+"</div>");
        };

        $("input").on("keyup", function (e) {
            if(e.keyCode != 13) {
                return;
            }
            var m = JSON.stringify({message: this.value, user: user, autoGenerated: false});
            this.value = "";
            console.log(m);
            websocket.send(m)
        });

    </script>

}
