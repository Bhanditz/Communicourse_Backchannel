@(implicit req: RequestHeader,username: String)

@main("Chatroom") {

    <div class="root">

        <div class="row root">

            <div class="col s4 m3 l3 chatroomPanel teal lighten-1">
                <div class = "row">
                    <div class = "col s12">
                        <h3 class = "flow-text">Communicourse</h3>
                    </div>
                    <div class = "col s12">
                        <ul class = "browser-default">
                            <li>
                                <h5 class = "flow-text">Mathematics</h5>
                            </li>
                            <li>
                                <h5 class = "flow-text">Computer Science</h5>
                            </li>
                            <li>
                                <h5 class = "flow-text">Law</h5>
                            </li>
                        </ul>
                    </div>
                </div>

            </div>

            <div class="col s8 m9 l9 chatPanel grey lighten-2">
                <div id="chat"></div>
                <input class = "chatPanel__input" type="text" name ="message" placeholder="ENTER A MESSAGE"/>
            </div>

        </div>
    </div>





    <script>

            var user = "@username";
            var websocket = new WebSocket("@controllers.routes.Application.chatUserSocket.webSocketURL()");
            websocket.onmessage = function(msgFromSocket) {
            var m = JSON.parse(msgFromSocket.data);
            console.log(m);
            console.log(msgFromSocket);
            var isItMe = m.user === user ?  "myMessage" : "friendsMessage right";
            var whoSentMessage = m.autoGenerated ? "botMessage right" : isItMe;
            var messageClass = "'"+whoSentMessage+"'";
            $("#chat").append(
                    "<div class = 'messageWrapper clearfix'>"
                        +"<div class="+messageClass+">"
                        +"<span>"+"<strong>"+ m.user + ": " + "</strong>" + m.message.replace(/\n/g,"<br>")+"</span>"+"</div>"
                    +"</div>");
        };

        $("input").on("keyup", function (e) {
            if(e.keyCode != 13) {
                return;
            }
            var m = JSON.stringify({message: this.value, user: user, autoGenerated: false});
            this.value = "";
            console.log(m);
            websocket.send(m)
        });

    </script>

}
